var Le=Object.defineProperty;var he=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ge=(r,o,e)=>o in r?Le(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e,Y=(r,o)=>{for(var e in o||(o={}))Ne.call(o,e)&&ge(r,e,o[e]);if(he)for(var e of he(o))ze.call(o,e)&&ge(r,e,o[e]);return r};var _=(r,o,e)=>new Promise((m,h)=>{var k=v=>{try{B(e.next(v))}catch(g){h(g)}},c=v=>{try{B(e.throw(v))}catch(g){h(g)}},B=v=>v.done?m(v.value):Promise.resolve(v.value).then(k,c);B((e=e.apply(r,o)).next())});import{O as I,a7 as R,a2 as Ie,a as C,c as N,w as we,aa as Pe,a3 as We,e as je,f as He,j as i,k as f,x as u,l as p,n as y,q as s,t as Me,K as V,ah as be,y as z,a5 as W,a6 as D,an as Te,F as O,H as K,I as xe,b as Ye,ao as Ke,ae as ke,aj as _e,ag as Ge,v as x,D as ee,ap as Je}from"./frappe-ui-D0s9hLeI.js";import Fe from"./FormField-HYhAgVMZ.js";import Ce from"./FileUploaderView-DbIitR0G.js";import{W as Qe}from"./WorkflowActionSheet-B_rv5dx0.js";import{u as Xe,g as Ze}from"./workflow-B78wL7-d.js";import{f as Ve}from"./formatters-B67gliVk.js";import"./Link-ByAo2phx.js";import"./index-6Eoza2Ey.js";function et(){const r=new FileReader;return r.__zone_symbol__originalInstance||r}class De{constructor(o){this.fileObj=o,this.fileName=o.name}upload(o,e,m){return _(this,null,function*(){return new Promise((h,k)=>_(this,null,function*(){const c=et(),B=I({url:"hrms.api.upload_base64_file",onSuccess:v=>h(v),onError:v=>{var g;R({title:"Error",text:`File upload failed for ${this.fileName}. ${((g=v.messages)==null?void 0:g[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),k(v)}});c.onload=()=>{console.log("Loaded successfully ✅"),this.fileContents=c.result.toString().split(",")[1],B.submit({content:this.fileContents,dt:o,dn:e,filename:this.fileName,fieldname:m})},c.readAsDataURL(this.fileObj)}))})}delete(){return I({url:"hrms.api.delete_attachment",onSuccess:()=>{console.log("Deleted successfully ✅")},onError:o=>{var e;R({title:"Error",text:`File deletion failed. ${((e=o.messages)==null?void 0:e[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}}).submit({filename:this.fileName})}}const te=(r,o)=>r.some(e=>o.includes(e));function tt(r,o){return _(this,null,function*(){var k;const m=yield I({url:"hrms.api.get_doctype_states",params:{doctype:r}}).reload();if((k=Object.keys(m||{}))!=null&&k.length){if((m==null?void 0:m[o])==="yellow")return"orange";if(m!=null&&m[o])return m==null?void 0:m[o]}let h="gray";return o=o.toLowerCase(),te(["open","pending","unpaid","review","medium","not approved"],o)?h="orange":te(["urgent","high","failed","rejected","error"],o)?h="red":te(["closed","finished","converted","completed","complete","confirmed","approved","yes","active","available","success"],o)?h="green":o==="submitted"&&(h="blue"),h})}const lt={key:0,class:"flex flex-col h-full w-full"},at={class:"w-full h-full bg-white sm:w-96 flex flex-col"},ot={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center sticky top-0 z-[1000]"},st={key:0,class:"flex flex-row items-center gap-2 overflow-hidden grow"},nt={class:"text-xl font-semibold text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis"},rt={key:1,class:"text-2xl font-semibold text-gray-900"},it={class:"bg-white grow overflow-y-auto"},dt={class:"px-4 sticky top-0 z-[100] bg-white text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700"},ut={class:"flex -mb-px overflow-auto hide-scrollbar"},ct={class:"mr-2 whitespace-nowrap"},mt=["onClick"],ft={class:"flex flex-col space-y-4 p-4"},pt={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},yt=u("span",{class:"text-gray-900 text-sm"},"Uploading...",-1),vt={key:1,class:"flex flex-col space-y-4 p-4"},ht={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},gt=u("span",{class:"text-gray-900 text-sm"},"Uploading...",-1),wt={key:0,class:"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg"},bt={key:2,class:"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg"},xt={class:"text-xl font-bold"},kt={class:"font-bold"},_t={class:"flex flex-row gap-4"},Ft=u("h2",{class:"text-xl font-bold"},"Confirm",-1),Ct={class:"font-bold"},Vt={class:"flex flex-row gap-4"},Dt=u("h2",{class:"text-xl font-bold"},"Confirm",-1),St={class:"font-bold"},$t={class:"flex flex-row gap-4"},zt={__name:"FormView",props:{doctype:{type:String,required:!0},modelValue:{type:Object,required:!0},isSubmittable:{type:Boolean,required:!1,default:!1},fields:{type:Array,required:!0},id:{type:String,required:!1},tabbedView:{type:Boolean,required:!1,default:!1},tabs:{type:Array,required:!1},showAttachmentView:{type:Boolean,required:!1,default:!1},showFormButton:{type:Boolean,required:!1,default:!0}},emits:["validateForm","update:modelValue"],setup(r,{emit:o}){var me;const e=r,m=o,h=Ie();let k=C((me=e.tabs)==null?void 0:me[0].name),c=C([]),B=C(""),v=C(""),g=C(!1),j=C(!1),F=C(!1),S=C(!1),$=C(!1),H=C(!1),q=C(null);const n=N({get(){return e.modelValue},set(l){m("update:modelValue",l)}}),M=N(()=>{if(!e.id)return"";if(q.value){const l=q.value.getWorkflowStateField();if(l)return n.value[l]}return n.value.status||n.value.approval_status});we(()=>n.value,()=>{e.id&&(Z.value&&!j.value?g.value=!0:j.value&&(j.value=!1))},{deep:!0}),we(()=>M.value,l=>_(this,null,function*(){l&&(B.value=yield tt(e.doctype,M.value))}),{immediate:!0});const Se=N(()=>{var A;let l={},t=[],b=0,E=0;return(A=e.tabs)==null||A.forEach(L=>{E=e.fields.findIndex(U=>U.fieldname===L.lastField),t=e.fields.slice(b,E+1),l[L.name]=t,b=E+1}),l}),le=I({url:"hrms.api.get_attachments",params:{dt:e.doctype,dn:e.id},transform(l){return l.map(t=>t.uploaded=!0)},onSuccess(l){c.value=l}}),ae=l=>{e.id?se(e.doctype,e.id,[...l.target.files]):c.value.push(...l.target.files)},oe=l=>_(this,null,function*(){l.uploaded?(yield new De(l).delete(),yield le.reload()):c.value=c.value.filter(t=>t.name!==l.name)});function se(l,t,b){return _(this,null,function*(){H.value=!0;const E=b.map(A=>new De(A).upload(l,t,"").then(U=>{U.uploaded=!0,e.id&&c.value.push(U)}));yield Promise.allSettled(E),H.value=!1})}const G=Pe({doctype:e.doctype,insert:{onSuccess(l){return _(this,null,function*(){R({title:"Success",text:`${e.doctype} created successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"}),yield se(l.doctype,l.name,c.value),h.replace({name:`${e.doctype.replace(/\s+/g,"")}DetailView`,params:{id:l.name}})})},onError(){R({title:"Error",text:`Error creating ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error creating ${e.doctype}`)}}}),w=We({doctype:e.doctype,name:e.id,fields:"*",setValue:{onSuccess(){R({title:"Success",text:`${e.doctype} updated successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){R({title:"Error",text:`Error updating ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error updating ${e.doctype}`)}},delete:{onSuccess(){h.back(),R({title:"Success",text:`${e.doctype} deleted successfully!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){R({title:"Error",text:`Error deleting ${e.doctype}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error deleting ${e.doctype}`)}}}),ne=I({url:"frappe.client.get_doc_permissions",params:{doctype:e.doctype,docname:e.id}}),re=I({url:"hrms.api.get_permitted_fields_for_write",params:{doctype:e.doctype}}),P=N(()=>{if(e.showFormButton){if(e.id&&e.isSubmittable&&!g.value){if(n.value.docstatus===0&&J("submit"))return"Submit";if(n.value.docstatus===1&&J("cancel"))return"Cancel"}else if(n.value.docstatus!==2)return"Save"}});function $e(){return e.id&&n.value.docstatus!==1&&J("delete")}function J(l){var t;return(t=ne.data)==null?void 0:t.permissions[l]}function ie(l){var t;return!!l.read_only||X.value||e.id&&!((t=re.data)!=null&&t.includes(l.fieldname))}function Be(){de()&&G.insert.submit(n.value)}function de(){const l=e.fields.filter(t=>t.reqd&&!t.hidden&&!n.value[t.fieldname]).map(t=>t.label);return l.length?(v.value=`${l.join(", ")} ${l.length>1?"fields are mandatory":"field is mandatory"}`,!1):(v.value="",!0)}function Q(l){return _(this,null,function*(){if(w.doc){let t=Y({},n.value);if(!de())return;l=="submit"?t.docstatus=1:l=="cancel"&&(t.docstatus=2),yield w.setValue.submit(t),yield w.get.promise,ce()}l==="submit"?S.value=!1:l==="cancel"&&($.value=!1)})}function Ee(){m("validateForm"),e.id?Q():Be()}function Re(){g.value||(n.value.docstatus===0?(m("validateForm"),S.value=!0):n.value.docstatus===1&&($.value=!0))}function qe(){w.delete.submit(),F.value=!1}function ue(){return _(this,null,function*(){yield w.reload(),ce()})}function ce(){n.value=Y({},w.doc),Je(()=>{g.value=!1,j.value=!0})}function Ae(){return _(this,null,function*(){const l=yield Ze(n.value.company);e.fields.forEach(t=>{t.fieldtype==="Currency"&&(t.readOnly||X.value)&&(t.options==="currency"?n.value[t.fieldname]=Ve(n.value[t.fieldname],n.value.currency):n.value[t.fieldname]=Ve(n.value[t.fieldname],l))})})}const X=N(()=>{var l;if(!Z.value)return!0;if(!e.id)return!1;if(n.value.docstatus!==0||(l=q.value)!=null&&l.isReadOnly(n.value))return!0}),Z=N(()=>e.id?!w.get.loading&&w.doc:!0);return je(()=>_(this,null,function*(){e.id&&(yield w.get.promise,n.value=Y({},w.doc),yield ne.reload(),yield re.reload(),yield le.reload(),yield Ae(),q.value=Xe(e.doctype),g.value=!1)})),(l,t)=>{var E,A,L,U,fe,pe,ye,ve;const b=He("Button");return i(),f(O,null,[Z.value?(i(),f("div",lt,[u("div",at,[u("header",ot,[p(b,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:t[0]||(t[0]=a=>s(h).back())},{default:y(()=>[p(s(Me),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),r.id?(i(),f("div",st,[u("h2",nt,V(r.doctype),1),p(s(be),{label:r.id,class:"whitespace-nowrap text-[8px]",variant:"outline"},null,8,["label"]),M.value?(i(),z(s(be),{key:0,label:M.value,theme:s(B),class:"whitespace-nowrap text-[8px]"},null,8,["label","theme"])):W("",!0),p(s(Te),{class:"ml-auto",options:[{label:"Delete",condition:$e,onClick:()=>D(F)?F.value=!0:F=!0},{label:"Reload",onClick:()=>ue()}],button:{label:"Menu",icon:"more-horizontal",variant:"ghost"}},null,8,["options"])])):(i(),f("h2",rt,V(`New ${r.doctype}`),1))]),u("div",it,[r.tabbedView?(i(),f(O,{key:0},[u("div",dt,[u("ul",ut,[(i(!0),f(O,null,K(r.tabs,a=>(i(),f("li",ct,[u("button",{onClick:T=>D(k)?k.value=a.name:k=a.name,class:xe(["inline-block py-4 px-2 border-b-2 border-transparent rounded-t-lg",[s(k)===a.name?"!text-gray-800 !border-gray-800":"hover:text-gray-600 hover:border-gray-300"]])},V(a.name),11,mt)]))),256))])]),(i(!0),f(O,null,K(Se.value,(a,T,Ue)=>Ye((i(),f("div",ft,[(i(!0),f(O,null,K(a,d=>(i(),f(O,{key:d.fieldname},[d.fieldtype=="Table"?ke(l.$slots,d.fieldname,{key:0,isFormReadOnly:X.value}):(i(),z(Fe,{key:1,fieldtype:d.fieldtype,fieldname:d.fieldname,modelValue:n.value[d.fieldname],"onUpdate:modelValue":Oe=>n.value[d.fieldname]=Oe,default:d.default,label:d.label,options:d.options,linkFilters:d.linkFilters,documentList:d.documentList,readOnly:ie(d),reqd:!!d.reqd,hidden:!!d.hidden,errorMessage:d.error_message,minDate:d.minDate,maxDate:d.maxDate,addSectionPadding:a[0].name!==d.name},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate","addSectionPadding"]))],64))),128)),s(H)?(i(),f("div",pt,[p(s(_e),{class:"w-3 h-3 text-gray-800"}),yt])):r.showAttachmentView&&Ue===0?(i(),z(Ce,{key:1,modelValue:s(c),"onUpdate:modelValue":t[1]||(t[1]=d=>D(c)?c.value=d:c=d),onHandleFileSelect:ae,onHandleFileDelete:oe},null,8,["modelValue"])):W("",!0)],512)),[[Ke,T===s(k)]])),256))],64)):(i(),f("div",vt,[(i(!0),f(O,null,K(e.fields,a=>(i(),z(Fe,{key:a.name,fieldtype:a.fieldtype,fieldname:a.fieldname,modelValue:n.value[a.fieldname],"onUpdate:modelValue":T=>n.value[a.fieldname]=T,default:a.default,label:a.label,options:a.options,linkFilters:a.linkFilters,documentList:a.documentList,readOnly:ie(a),reqd:!!a.reqd,hidden:!!a.hidden,errorMessage:a.error_message,minDate:a.minDate,maxDate:a.maxDate},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate"]))),128)),s(H)?(i(),f("div",ht,[p(s(_e),{class:"w-3 h-3 text-gray-800"}),gt])):r.showAttachmentView?(i(),z(Ce,{key:1,modelValue:s(c),"onUpdate:modelValue":t[2]||(t[2]=a=>D(c)?c.value=a:c=a),onHandleFileSelect:ae,onHandleFileDelete:oe},null,8,["modelValue"])):W("",!0)]))]),r.showFormButton?!s(g)&&((E=s(q))!=null&&E.hasWorkflow)?(i(),z(Qe,{key:1,doc:s(w).doc,workflow:s(q),onWorkflowApplied:t[3]||(t[3]=a=>ue())},null,8,["doc","workflow"])):s(g)||!((A=s(q))!=null&&A.hasWorkflow)&&P.value?(i(),f("div",bt,[p(s(Ge),{class:"mb-2",message:s(v)||((U=(L=s(G))==null?void 0:L.insert)==null?void 0:U.error)||((pe=(fe=s(w))==null?void 0:fe.setValue)==null?void 0:pe.error)},null,8,["message"]),p(b,{class:xe(["w-full rounded py-5 text-base disabled:bg-gray-700 disabled:text-white",P.value==="Cancel"?"shadow":""]),onClick:t[4]||(t[4]=a=>P.value==="Save"?Ee():Re()),variant:P.value==="Cancel"?"subtle":"solid",loading:s(G).insert.loading||((ve=(ye=s(w))==null?void 0:ye.setValue)==null?void 0:ve.loading)},{default:y(()=>[x(V(P.value),1)]),_:1},8,["class","variant","loading"])])):W("",!0):(i(),f("div",wt,[ke(l.$slots,"formButton")]))])])):W("",!0),p(s(ee),{modelValue:s(F),"onUpdate:modelValue":t[6]||(t[6]=a=>D(F)?F.value=a:F=a)},{"body-title":y(()=>[u("h2",xt,"Delete "+V(e.doctype),1)]),"body-content":y(()=>[u("p",null,[x(" Are you sure you want to delete the "+V(e.doctype)+" ",1),u("span",kt,V(n.value.name),1),x(" ? ")])]),actions:y(()=>[u("div",_t,[p(b,{variant:"outline",class:"py-5 w-full",onClick:t[5]||(t[5]=a=>D(F)?F.value=!1:F=!1)},{default:y(()=>[x(" Cancel ")]),_:1}),p(b,{variant:"solid",theme:"red",onClick:qe,class:"py-5 w-full"},{default:y(()=>[x(" Delete ")]),_:1})])]),_:1},8,["modelValue"]),p(s(ee),{modelValue:s(S),"onUpdate:modelValue":t[9]||(t[9]=a=>D(S)?S.value=a:S=a)},{"body-title":y(()=>[Ft]),"body-content":y(()=>[u("p",null,[x(" Permanently submit "+V(e.doctype)+" ",1),u("span",Ct,V(n.value.name),1),x(" ? ")])]),actions:y(()=>[u("div",Vt,[p(b,{variant:"outline",class:"py-5 w-full",onClick:t[7]||(t[7]=a=>D(S)?S.value=!1:S=!1)},{default:y(()=>[x(" No ")]),_:1}),p(b,{variant:"solid",onClick:t[8]||(t[8]=a=>Q("submit")),class:"py-5 w-full"},{default:y(()=>[x(" Yes ")]),_:1})])]),_:1},8,["modelValue"]),p(s(ee),{modelValue:s($),"onUpdate:modelValue":t[12]||(t[12]=a=>D($)?$.value=a:$=a)},{"body-title":y(()=>[Dt]),"body-content":y(()=>[u("p",null,[x(" Permanently cancel "+V(e.doctype)+" ",1),u("span",St,V(n.value.name),1),x("? ")])]),actions:y(()=>[u("div",$t,[p(b,{variant:"outline",class:"py-5 w-full",onClick:t[10]||(t[10]=a=>D($)?$.value=!1:$=!1)},{default:y(()=>[x(" No ")]),_:1}),p(b,{variant:"solid",onClick:t[11]||(t[11]=a=>Q("cancel")),class:"py-5 w-full"},{default:y(()=>[x(" Yes ")]),_:1})])]),_:1},8,["modelValue"])],64)}}};export{zt as default};
//# sourceMappingURL=FormView-BgupmWP-.js.map
