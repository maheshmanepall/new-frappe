import{i as C,a as y,O as H,aa as P,c as v,e as U,ab as q,f as z,j as c,k as d,x as l,K as s,q as n,F as Y,a5 as g,l as $,n as k,t as A,v as E,y as G,a7 as T}from"./frappe-ui-D0s9hLeI.js";import{I as K,m as J}from"./index-6Eoza2Ey.js";const Q={class:"flex flex-col bg-white rounded w-full py-6 px-4 border-none"},W={class:"text-lg font-bold text-gray-900"},X={key:0,class:"font-medium text-sm text-gray-500 mt-1.5"},Z={key:1,class:"font-medium text-sm text-gray-500 mt-1.5"},ee={class:"h-120 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5"},te={class:"flex flex-col gap-1.5 mt-2 items-center justify-center"},oe={class:"font-bold text-xl"},ae={class:"font-medium text-gray-500 text-sm"},se={key:0,class:"font-medium text-gray-500 text-sm"},ne={class:"rounded border-4 translate-z-0 block overflow-hidden w-full h-170"},le=["src"],b="Employee Checkin",ue={__name:"CheckInPanel",setup(ie){const m=C("$socket"),x=C("$employee"),t=C("$dayjs"),w=y(null),f=y(0),_=y(0),i=y(""),p=H({url:"hrms.api.get_hr_settings",auto:!0}),r=P({doctype:b,fields:["name","employee","employee_name","log_type","time","device_id"],filters:{employee:x.data.name},orderBy:"time desc"});r.reload();const o=v(()=>r.list.loading||!r.data?{}:r.data[0]),j=v(()=>{var e;return((e=o==null?void 0:o.value)==null?void 0:e.log_type)==="IN"?"check-in":"check-out"}),h=v(()=>{var e;return((e=o==null?void 0:o.value)==null?void 0:e.log_type)==="IN"?{action:"OUT",label:"Check Out"}:{action:"IN",label:"Check In"}}),L=v(()=>{var u;const e=(u=o==null?void 0:o.value)==null?void 0:u.time,a=t(e).format("hh:mm a");return t(e).isToday()?a:t(e).isYesterday()?`${a} yesterday`:t(e).isSame(t(),"year")?`${a} on ${t(e).format("D MMM")}`:`${a} on ${t(e).format("D MMM, YYYY")}`});function S(e){f.value=e.coords.latitude,_.value=e.coords.longitude,i.value=`
		Latitude: ${Number(f.value).toFixed(5)}Â°,
		Longitude: ${Number(_.value).toFixed(5)}Â°
	`}function O(e){i.value="Unable to retrieve your location",e&&(i.value+=`: ERROR(${e.code}): ${e.message}`)}const R=()=>{navigator.geolocation?(i.value="Locating...",navigator.geolocation.getCurrentPosition(S,O)):i.value="Geolocation is not supported by your current browser"},F=()=>{var e;w.value=t().format("YYYY-MM-DD HH:mm:ss"),(e=p.data)!=null&&e.allow_geolocation_tracking&&R()},V=e=>{const a=e==="IN"?"Check-in":"Check-out";r.insert.submit({employee:x.data.name,log_type:e,time:w.value,latitude:f.value,longitude:_.value},{onSuccess(){J.dismiss(),T({title:"Success",text:`${a} successful!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){T({title:"Error",text:`${a} failed!`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}})};return U(()=>{m.emit("doctype_subscribe",b),m.on("list_update",e=>{e.doctype==b&&r.reload()})}),q(()=>{m.emit("doctype_unsubscribe",b),m.off("list_update")}),(e,a)=>{var M,N,I,B;const u=z("Button");return c(),d(Y,null,[l("div",Q,[l("h2",W,"Hey, "+s((N=(M=n(x))==null?void 0:M.data)==null?void 0:N.first_name)+" ðŸ‘‹",1),(I=n(p).data)!=null&&I.allow_employee_checkin_from_mobile_app?(c(),d(Y,{key:0},[o.value?(c(),d("div",X," Last "+s(j.value)+" was at "+s(L.value),1)):g("",!0),$(u,{class:"mt-4 mb-1 drop-shadow-sm py-5 text-base",id:"open-checkin-modal",onClick:F},{prefix:k(()=>[$(n(A),{name:h.value.action==="IN"?"arrow-right-circle":"arrow-left-circle",class:"w-4"},null,8,["name"])]),default:k(()=>[E(" "+s(h.value.label),1)]),_:1})],64)):(c(),d("div",Z,s(n(t)().format("ddd, D MMMM, YYYY")),1))]),(B=n(p).data)!=null&&B.allow_employee_checkin_from_mobile_app?(c(),G(n(K),{key:0,ref:"modal",trigger:"open-checkin-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:k(()=>{var D;return[l("div",ee,[l("div",te,[l("div",oe,s(n(t)(w.value).format("hh:mm:ss a")),1),l("div",ae,s(n(t)().format("D MMM, YYYY")),1)]),(D=n(p).data)!=null&&D.allow_geolocation_tracking?(c(),d(Y,{key:0},[i.value?(c(),d("span",se,s(i.value),1)):g("",!0),l("div",ne,[l("iframe",{width:"100%",height:"170",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",style:{border:"0"},src:`https://maps.google.com/maps?q=${f.value},${_.value}&hl=en&z=15&output=embed`},null,8,le)])],64)):g("",!0),$(u,{variant:"solid",class:"w-full py-5 text-sm",onClick:a[0]||(a[0]=ce=>V(h.value.action))},{default:k(()=>[E(" Confirm "+s(h.value.label),1)]),_:1})])]}),_:1},512)):g("",!0)],64)}}};export{ue as default};
//# sourceMappingURL=CheckInPanel-C5HCl5wI.js.map
