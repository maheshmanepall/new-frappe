{"version":3,"file":"workflow-B78wL7-d.js","sources":["../../../../frontend/src/data/currencies.js","../../../../frontend/src/composables/workflow.js"],"sourcesContent":["import { createResource } from \"frappe-ui\"\n\nconst companyCurrency = createResource({\n\turl: \"hrms.api.get_company_currencies\",\n\tauto: true,\n})\n\nconst currencySymbols = createResource({\n\turl: \"hrms.api.get_currency_symbols\",\n\tauto: true,\n})\n\nexport function getCompanyCurrency(company) {\n\treturn companyCurrency?.data?.[company]?.[0]\n}\n\nexport function getCompanyCurrencySymbol(company) {\n\treturn companyCurrency?.data?.[company]?.[1]\n}\n\nexport function getCurrencySymbol(currency) {\n\treturn currencySymbols?.data?.[currency]\n}\n","import { createResource, toast } from \"frappe-ui\"\nimport { computed } from \"vue\"\nimport { userResource } from \"@/data/user\"\n\nexport default function useWorkflow(doctype) {\n\tconst workflowDoc = createResource({\n\t\turl: \"hrms.api.get_workflow\",\n\t\tparams: { doctype: doctype },\n\t\tcache: [\"hrms:workflow\", doctype],\n\t})\n\tworkflowDoc.reload()\n\n\tconst hasWorkflow = computed(() => {\n\t\tconst workflowData = workflowDoc?.data\n\t\treturn Boolean(Object.keys(workflowData || {}).length > 0)\n\t})\n\n\tconst getWorkflowStateField = () => {\n\t\t// NOTE: checkbox labelled 'Don't Override Status' is named override_status hence the inverted logic\n\t\treturn !workflowDoc.data?.override_status\n\t\t\t? workflowDoc.data?.workflow_state_field\n\t\t\t: \"\"\n\t}\n\n\tconst getDefaultState = (docstatus) => {\n\t\treturn workflowDoc.data?.states.find(\n\t\t\t(state) => state.doc_status == docstatus\n\t\t)\n\t}\n\n\tconst getTransitions = async (doc) => {\n\t\tconst transitions = createResource({\n\t\t\turl: \"frappe.model.workflow.get_transitions\",\n\t\t\tparams: { doc: doc },\n\t\t\ttransform: (data) => {\n\t\t\t\tconst isSelfApproval = userResource?.data?.name == doc.owner\n\n\t\t\t\treturn data\n\t\t\t\t\t.filter(\n\t\t\t\t\t\t(transition) => transition.allow_self_approval || !isSelfApproval\n\t\t\t\t\t)\n\t\t\t\t\t.map((transition) => transition.action)\n\t\t\t},\n\t\t})\n\n\t\treturn await transitions.reload()\n\t}\n\n\tconst getDocumentStateRoles = (state) => {\n\t\treturn workflowDoc.data?.states\n\t\t\t.filter((s) => s.state == state)\n\t\t\t.map((s) => s.allow_edit)\n\t}\n\n\tconst isReadOnly = (doc) => {\n\t\tconst state_fieldname = workflowDoc.data?.workflow_state_field\n\t\tif (!state_fieldname) return false\n\n\t\tconst state = doc[state_fieldname] || getDefaultState(doc.docstatus)\n\n\t\tconst roles = getDocumentStateRoles(state)\n\t\treturn !roles.some((role) => userResource.data.roles.includes(role))\n\t}\n\n\tconst applyWorkflow = async (doc, action) => {\n\t\tconst applyWorkflow = createResource({\n\t\t\turl: \"frappe.model.workflow.apply_workflow\",\n\t\t\tparams: { doc: doc, action: action },\n\t\t\tonSuccess() {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: \"Success\",\n\t\t\t\t\ttext: `Workflow action '${action}' applied successfully`,\n\t\t\t\t\ticon: \"check-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t\t})\n\t\t\t},\n\t\t\tonError() {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: \"Error\",\n\t\t\t\t\ttext: `Error applying workflow action: ${action}`,\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t\tconsole.log(`Error applying workflow action: ${action}`)\n\t\t\t},\n\t\t})\n\t\tawait applyWorkflow.reload()\n\t}\n\n\treturn {\n\t\thasWorkflow,\n\t\tworkflowDoc,\n\t\tgetWorkflowStateField,\n\t\tgetTransitions,\n\t\tgetDocumentStateRoles,\n\t\tisReadOnly,\n\t\tapplyWorkflow,\n\t}\n}\n"],"names":["companyCurrency","createResource","currencySymbols","getCompanyCurrency","company","_b","_a","getCompanyCurrencySymbol","getCurrencySymbol","currency","useWorkflow","doctype","workflowDoc","hasWorkflow","computed","workflowData","getWorkflowStateField","getDefaultState","docstatus","state","getTransitions","doc","__async","data","isSelfApproval","userResource","transition","getDocumentStateRoles","state_fieldname","role","action","toast"],"mappings":"gTAEA,MAAMA,EAAkBC,EAAe,CACtC,IAAK,kCACL,KAAM,EACP,CAAC,EAEKC,EAAkBD,EAAe,CACtC,IAAK,gCACL,KAAM,EACP,CAAC,EAEM,SAASE,EAAmBC,EAAS,SAC3C,OAAOC,GAAAC,EAAAN,GAAA,YAAAA,EAAiB,OAAjB,YAAAM,EAAwBF,KAAxB,YAAAC,EAAmC,EAC3C,CAEO,SAASE,EAAyBH,EAAS,SACjD,OAAOC,GAAAC,EAAAN,GAAA,YAAAA,EAAiB,OAAjB,YAAAM,EAAwBF,KAAxB,YAAAC,EAAmC,EAC3C,CAEO,SAASG,EAAkBC,EAAU,OAC3C,OAAOH,EAAAJ,GAAA,YAAAA,EAAiB,OAAjB,YAAAI,EAAwBG,EAChC,CClBe,SAASC,EAAYC,EAAS,CAC5C,MAAMC,EAAcX,EAAe,CAClC,IAAK,wBACL,OAAQ,CAAE,QAASU,CAAS,EAC5B,MAAO,CAAC,gBAAiBA,CAAO,CAClC,CAAE,EACDC,EAAY,OAAQ,EAEpB,MAAMC,EAAcC,EAAS,IAAM,CAClC,MAAMC,EAAeH,GAAA,YAAAA,EAAa,KAClC,OAAe,OAAO,KAAKG,GAAgB,EAAE,EAAE,OAAS,CAC1D,CAAE,EAEKC,EAAwB,IAAM,SAEnC,OAAQV,EAAAM,EAAY,OAAZ,MAAAN,EAAkB,gBAEvB,IADAD,EAAAO,EAAY,OAAZ,YAAAP,EAAkB,oBAErB,EAEKY,EAAmBC,GAAc,OACtC,OAAOZ,EAAAM,EAAY,OAAZ,YAAAN,EAAkB,OAAO,KAC9Ba,GAAUA,EAAM,YAAcD,EAEhC,EAEKE,EAAwBC,GAAQC,EAAA,sBAerC,OAAO,MAdarB,EAAe,CAClC,IAAK,wCACL,OAAQ,CAAE,IAAKoB,CAAK,EACpB,UAAYE,GAAS,SACpB,MAAMC,IAAiBnB,GAAAC,EAAAmB,IAAA,YAAAnB,EAAc,OAAd,YAAAD,EAAoB,OAAQgB,EAAI,MAEvD,OAAOE,EACL,OACCG,GAAeA,EAAW,qBAAuB,CAACF,CACnD,EACA,IAAKE,GAAeA,EAAW,MAAM,CACvC,CACJ,CAAG,EAEwB,OAAQ,CACjC,GAEKC,EAAyBR,GAAU,OACxC,OAAOb,EAAAM,EAAY,OAAZ,YAAAN,EAAkB,OACvB,OAAQ,GAAM,EAAE,OAASa,GACzB,IAAK,GAAM,EAAE,WACf,EAuCD,MAAO,CACN,YAAAN,EACA,YAAAD,EACA,sBAAAI,EACA,eAAAI,EACA,sBAAAO,EACA,WA3CmBN,GAAQ,OAC3B,MAAMO,GAAkBtB,EAAAM,EAAY,OAAZ,YAAAN,EAAkB,qBAC1C,GAAI,CAACsB,EAAiB,MAAO,GAE7B,MAAMT,EAAQE,EAAIO,CAAe,GAAKX,EAAgBI,EAAI,SAAS,EAGnE,MAAO,CADOM,EAAsBR,CAAK,EAC3B,KAAMU,GAASJ,EAAa,KAAK,MAAM,SAASI,CAAI,CAAC,CACnE,EAoCA,cAlCqB,CAAOR,EAAKS,IAAWR,EAAA,sBAwB5C,MAvBsBrB,EAAe,CACpC,IAAK,uCACL,OAAQ,CAAE,IAAKoB,EAAK,OAAQS,CAAQ,EACpC,WAAY,CACXC,EAAM,CACL,MAAO,UACP,KAAM,oBAAoBD,CAAM,yBAChC,KAAM,eACN,SAAU,gBACV,YAAa,gBAClB,CAAK,CACD,EACD,SAAU,CACTC,EAAM,CACL,MAAO,QACP,KAAM,mCAAmCD,CAAM,GAC/C,KAAM,eACN,SAAU,gBACV,YAAa,cAClB,CAAK,EACD,QAAQ,IAAI,mCAAmCA,CAAM,EAAE,CACvD,CACJ,CAAG,EACmB,OAAQ,CAC5B,EAUA,CACF"}